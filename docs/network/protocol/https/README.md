---
title: "网络世界-HTTPS"
tags:
  - HTTPS
---

# HTTPS 协议

运行在 **SSL/TLS** 协议上的 HTTP，保证通信的安全

## 通信安全

通常认为通信过程具备了**四个特性**，就可以认为是安全的：

1. 机密性
2. 完整性
3. 身份认证
4. 不可否认

## SSL/TLS 协议

是一个负责加密通信的安全协议，建立在 TCP/IP 之上，综合**对称加密**、**非对称加密**、**摘要算法**、**数字签名**、**数字证书**等技术，保证通信的安全

SSL 即安全套接层，在 OSI 模型中处于第五层，会话层。SSL 发展到 V3 时，更名为 TLS，正式标准化，所以 TLS1.0 就是 SSLv3.1，目前应用最广的是 TLS1.2

浏览器和服务器在使用 TLS 建立连接时需要选择一组恰当的加密算法来实现安全通信，这些算法的组合称为**密码套件或者加密套件**

TLS 加密套件的命名格式很固定，基本形式是：**密钥交换算法 + 签名算法 + 对称加密算法 + 摘要算法**

在 TSL1.2 中，客户端和服务器都支持非常多的密码套件，最终协商选定一组，比如是：

```
ECDHE-RSA-AES256-GCM-SHA384
```

::: tip
它的意思就是：握手时使用 `ECDHE` 算法进行密钥交换，用 `RSA` 签名和身份认证，握手后的通信使用 `AES` 对称算法进行加密，密钥长度 `256` 位，分组模式是 `GCM`，摘要算法 `SHA384` 用于消息认证和产生随机数

---

机密性由对称加密 `AES` 保证，完整性由 `SHA384`、`SHA256` 摘要算法保证，身份认证和不可否认由非对称加密 `RSA` 保证
:::

## 对称加密和非对称加密

### 对称加密

实现机密性最常用的手段就是**加密**。把明文转换成别人看不懂的密文，只有掌握**密钥**的人才能解密出原始文本。TLS 用到的密钥就是一长串数字，用 `位（bit）` 而非 `字节（byte）` 去度量。比如说密钥长度是 128，即 16 个字节的二进制串；密钥长度 1024 即 128 字节的二进制串

**对称加密**的加密和解密使用同一个密钥，是对称的。整个通信过程中传输的全是加密后的密文，只要保证密钥的安全，机密性就得到了保证，应用最广泛的对称加密算法是 `AES`

对称算法还有一个**分组模式**的概念，可以让算法用固定长度的密钥加密任意长度的明文，常用的是 `GCM`

### 非对称加密

对称加密存在的问题是，如何安全的把密钥传递给对方，即**密钥交换**，因为对于对称加密来说，只要持有密钥，就可以进行解密，因此如果密钥在传递过程中被窃取，那就没有机密性可言了，这就需要用到**非对称加密**

**非对称加密**有**两个密钥**，分为**公钥**和**私钥**。两个密钥是不同的，不对称，公钥公开，私钥严格保密

**网站持有私钥，对外发布公钥**

公钥加密后只能用私钥解密，私钥加密后也只能用公钥解密，算法有比较老的 DH，出名的 RSA 和比较新的 ECC 椭圆曲线。RSA 基于整数分解，使用两个超大素数的乘积作为生成密钥的材料。由于非对称加密基于复杂的数学难题，所以运算量较大，速度慢性能较低

公钥和私钥有特别的单向性：它俩虽然都可以用来加密和解密，**但公钥加密后只能用私钥来解密；反过来一样，私钥加密后只能用公钥来解密**

非对称加密可以解决密钥交换的问题。网站持有私钥，公开分发公钥，想要登录网站，只要用公钥加密就行了，密文只有私钥持有者才能解密，别人即使拿到密文也只是一串乱码，无法破解

非对称加密算法都基于复杂的数学难题，设计起来要比对称加密难的多，只有有限几种，比如最著名的 `RSA` 和 比较新的 `ECC`

`RSA` 基于“整数分解”的数学难题，使用两个超大素数的乘积作为生成密钥的材料（但 TLS1.3 已废除）

`ECC` 基于“椭圆曲线离散对数”的数学难题，子算法 `ECDHE` 用于密钥交换，`ECDSA` 用于数字签名，目前常用的两个曲线是 P-256 和 x25519 蒙哥马利曲线，ECC 在安全强度和性能上都优于 RSA

## TLS 使用了混合加密

非对称加密的运算速度与对称加密比如 `AES` 比起来要慢很多，所以现在的 TLS 协议使用了**混合加密**的方式：

- 在通信刚开始时使用非对称加密算法比如 `RSA`、`ECDHE` 首先解决密钥交换的问题
- 然后用随机数产生对称算法使用的会话密钥，再用公钥加密
- 对方拿到密文后用私钥解密，得到会话密钥
- 至此双方实现了对称密钥的安全交换，后续的通信就可以使用对称加密进行
  这样混合加密解决了对称加密算法的密钥交换问题，且安全和性能兼顾，很好的实现了机密性
  :::tip
  本质上来说，非对称加密只是用来加密对称加密的密钥，实现对称密钥的安全交换的，并且对称加密的密钥又是会话级别的随机数产生的，即一个会话一个私钥，就算暴力破解也只是破解了一个会话

混合加密中用到了公钥加密，因为只能由私钥解密；反过来，私钥加密只能由公钥解密是为了**做身份认证，不可抵赖，因为默认私钥只有持有人才拥有**也就是**数字签名**
:::
